Jx().$package(function(d){var e=function(){return 0};e=d.Class({init:function(){throw"BaseAudio does not implement a required interface";},play:e,pause:e,stop:e,getVolume:e,setVolume:e,getLoop:e,setLoop:e,setMute:e,getMute:e,getPosition:e,setPosition:e,getBuffered:e,getDuration:e,free:e,on:e,off:e});var i={NONE:0,NATIVE:1,WMP:2,FLASH:3,MOBILE:4},f=function(){var a;return function(b){if(!a){var c=document.createElement("div");c.style.cssText="position:absolute;width:1px;height:1px;overflow:hidden;margin:0;padding:0;left:0;top:0;";
(document.body||document.documentElement).appendChild(c);if(b==i.FLASH){c.innerHTML='<object id="JxAudioObject" name="JxAudioObject" '+(d.browser.ie?'classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000"':'type="application/x-shockwave-flash" data="jxaudioobject.swf"')+'width="1" height="1" align="top">                        <param name="movie" value="jxaudioobject.swf" /><param name="allowScriptAccess" value="always" /><param name="allowFullScreen" value="false" /><param name="quality" value="high" /><param name="wmode" value="opaque" />                        </object>';
a=d.dom.id("JxAudioObject")||window.JxAudioObject||document.JxAudioObject}else a=c}return a}}(),n=function(){var a=0;return function(){return a++}}(),o=function(){if(window.Audio&&(new Audio).canPlayType("audio/mpeg")){if(/\bmobile\b/i.test(navigator.userAgent))return i.MOBILE;return i.NATIVE}else return d.browser.plugins.flash>=9?i.FLASH:window.ActiveXObject&&function(){try{new ActiveXObject("WMPlayer.OCX.7")}catch(a){return false}return true}()?i.WMP:i.NONE}();switch(o){case i.NATIVE:case i.MOBILE:var k=
d.Class({extend:e},{init:function(a){a=a||{};(this._el=new Audio).loop=Boolean(a.loop);a.src&&this.play(a.src)},play:function(a){if(a)this._el.src=a;this._el.paused&&this._el.play()},pause:function(){this._el.pause()},stop:function(){this._el.duration=Infinity},getVolume:function(){return!this._el.muted&&this._el.volume||0},setVolume:function(a){if(isFinite(a)){this._el.volume=Math.max(0,Math.min(a,1));this._el.muted=false}},getLoop:function(){return this._el.loop},setLoop:function(a){this._el.loop=
a!==false},getMute:function(){return this._el.muted},setMute:function(a){this._el.muted=a!==false},getPosition:function(){return this._el.currentTime},setPosition:function(a){if(!isNaN(a))this._el.currentTime=Math.max(0,a)},getBuffered:function(){return this._el.buffered.length&&this._el.buffered.end(0)||0},getDuration:function(){return this._el.duration},free:function(){this._el.pause();this._el=null},on:function(a,b){this._el.addEventListener(a,b,false)},off:function(a,b){this._el.removeEventListener(a,
b,false)}});if(o=i.NATIVE){d.Audio=k;break}var j=[],l=function(){var a=j.length;j.pop().off("ended",l);a>=2&&j[a-2]._el.play()};d.Audio=d.Class({extend:k},{init:function(a){k.prototype.init.call(this,a)},play:function(a){var b=j.length;if(b&&j[b-1]!==this){b=d.array.indexOf(j,this);-1!==b?j.splice(b,1):this.on("ended",l)}j.push(this);if(a)this._el.src=a;this._el.paused&&this._el.play()},pause:function(){for(var a=0,b=j.length;a<b;a++)j[a].off("ended",l);j=[];this._el.pause()}});break;case i.FLASH:var q=
function(){var a=0,b=[],c=false,g=function(){++a;var h=f();if(h.audioLoad&&typeof h.audioLoad==="function"){c=true;h=0;for(var m=b.length;h<m;h++)b[h]._sync();b=null}else a<3E4&&setTimeout(g,100)};return function(h){if(c)h._sync();else{-1===d.array.indexOf(b,h)&&b.push(h);a===0&&g()}}}(),p;(function(){var a=[];window.Jx.AudioEventDispatcher=function(b,c,g){b=a[b];var h;b&&b._handler&&(h=b._handler[c]);c=0;for(var m=h&&h.length;c<m;c++)h[c].call(b,g)};p=function(b){a[b._seq]=b}})();d.Audio=d.Class({init:function(a){this._seq=
n();this._volume=1;this._muted=false;a=a||{};this._loop=Boolean(a.loop);this._paused=true;f(i.FLASH);a.src&&this.play(a.src)},play:function(a){var b=f();if(a){this._src=a;this._paused=false;b.audioLoad?this._sync():q(this)}else{this._paused=false;b.audioPlay&&b.audioPlay(this._seq)}},pause:function(){var a=f();this._paused=true;a.audioPause&&a.audioPause(this._seq)},stop:function(){this._paused=true;var a=f();a.audioStop&&a.audioStop(this._seq)},getVolume:function(){return!this._muted&&this._volume||
0},setVolume:function(a){if(isFinite(a)){this._volume=Math.max(0,Math.min(a,1));this._muted=false;a=f();a.audioSetVolume&&a.audioSetVolume(this._seq,this._volume)}},getLoop:function(){return this._loop},setLoop:function(a){this._loop=a!==false;a=f();a.audioSetLoop&&a.audioSetLoop(this._loop)},getMute:function(){return this._muted},setMute:function(a){this._muted=a!==false;a=f();a.audioSetVolume&&a.audioSetVolume(this._seq,this.getVolume())},getPosition:function(){var a=f();return a.audioGetPosition&&
a.audioGetPosition(this._seq)/1E3||0},setPosition:function(a){isNaN(a)||f().audioSetPosition(this._seq,Math.max(0,a)*1E3)},getBuffered:function(){var a=f();return a.audioGetBuffered&&a.audioGetBuffered(this._seq)/1E3||0},getDuration:function(){var a=f();return a.audioGetDuration&&a.audioGetDuration(this._seq)/1E3||0},free:function(){this._paused=true;var a=f();a.audioFree&&a.audioFree(this._seq)},on:function(a,b){if(!this._handler){this._handler={};p(this)}if(!this._handler[a]||!this._handler[a].length){this._handler[a]=
[b];b=f();b.audioOn&&b.audioOn(this._seq,a)}else-1===d.array.indexOf(this._handler[a],b)&&this._handler[a].push(b)},off:function(a,b){var c;if(this._handler&&this._handler[a]&&-1!==(c=d.array.indexOf(this._handler[a],b))){this._handler[a].splice(c,1);if(!this._handler[a].length){b=f();b.audioOff&&b.audioOff(this._seq,a);delete this._handler[a]}}},_sync:function(){if(this._src){var a=f(),b=this._seq;a.audioLoad(b,this._src);var c=this.getVolume();c!=1&&a.audioSetVolume(b,c);this._loop&&a.audioSetLoop(b,
true);for(var g in this._handler)a.audioOn(b,g);this._paused||a.audioPlay(b)}}});break;case i.WMP:d.Audio=d.Class({extend:e},{init:function(a){this._seq=n();a=a||{};var b=document.createElement("div");f(i.WMP).appendChild(b);b.innerHTML='<object id="WMPObject'+this._seq+'" classid="CLSID:6BF52A52-394A-11D3-B153-00C04F79FAA6" standby="" type="application/x-oleobject" width="0" height="0">                        <param name="AutoStart" value="true"><param name="ShowControls" value="0"><param name="uiMode" value="none"></object>';
this._el=d.dom.id("WMPObject"+this._seq)||window["WMPObject"+this._seq];a.loop&&this._el.settings.setMode("loop",true);a.src&&this.play(a.src)},play:function(a){if(a){var b=document.createElement("a");b.href=a;d.dom.getHref(b);this._canPlayThroughFired=this._isBuffering=this._isPlaying=false;this._el.URL=d.dom.getHref(b)}this._el.playState!==3&&this._el.controls.play();this._hasPoll()&&this._startPoll()},pause:function(){this._el.controls.pause()},stop:function(){this._el.controls.stop()},getVolume:function(){return!this._el.settings.mute&&
this._el.settings.volume/100||0},setVolume:function(a){if(isFinite(a)){a=Math.max(0,Math.min(a,1))*100;if(this._el.settings.volume!==a||this._el.settings.mute){this._el.settings.volume=a;this._el.settings.mute=false;this._fire("volumechange")}}},getLoop:function(){return this._el.settings.getMode("loop")},setLoop:function(a){this._el.settings.setMode("loop",a!==false)},getMute:function(){return this._el.settings.mute},setMute:function(a){a=a!==false;if(this._el.settings.mute!==a){this._el.settings.mute=
a;this._fire("volumechange")}},getPosition:function(){return this._el.controls.currentPosition},setPosition:function(a){if(!isNaN(a)){this._fire("seeking");this._el.controls.currentPosition=Math.max(0,a)}},getBuffered:function(){return this._el.network.downloadProgress*0.01*this.getDuration()},getDuration:function(){return(this._el.currentMedia||0).duration||0},free:function(){this._el.controls.stop();this._el=null},on:function(a,b){if(!this._handler)this._handler={};var c=this;switch(a){case "timeupdate":this._startPoll();
case "seeked":if(!this._hasPositionChange()){this._onPositionChange=function(){c._fire("timeupdate");c._fire("seeked")};this._el.attachEvent("PositionChange",this._onPositionChange)}break;case "waiting":case "playing":if(!this._hasBuffering()){this._onBuffering=function(g){if((c._el.currentMedia||0).sourceURL)if(g){c._isBuffering=true;c._fire("waiting")}else{c._isBuffering=false;c._fire("playing")}};this._el.attachEvent("Buffering",this._onBuffering)}break;case "error":this._el.attachEvent("Error",
b);break;case "progress":case "ended":case "play":case "pause":if(!this._hasPlayStateChange()){this._onPlayStateChange=function(g){if((c._el.currentMedia||0).sourceURL)if(g===2){c._isPlaying=false;c._fire("pause")}else if(g===3){if(!c._isPlaying){c._isPlaying=true;c._fire("play")}}else if(g===6)c._fire("progress");else if(g===1)if(c._isPlaying){c._isPlaying=false;c._fire("ended");c._stopPoll()}};this._el.attachEvent("PlayStateChange",this._onPlayStateChange)}break;case "loadstart":case "loadeddata":case "canplay":if(!this._hasOpenStateChange()){this._onOpenStateChange=
function(g){if((c._el.currentMedia||0).sourceURL)if(g===21)c._fire("loadstart");else if(g===13){c._fire("loadeddata");c._fire("canplay")}};this._el.attachEvent("OpenStateChange",this._onOpenStateChange)}break;case "canplaythrough":case "durationchange":this._startPoll();break;default:break}(this._handler[a]||(this._handler[a]=[])).push(b)},off:function(a,b){if(this._handler){var c;if(this._handler&&this._handler[a]&&-1!==(c=d.array.indexOf(this._handler[a],b)))this._handler[a].splice(c,1);switch(a){case "timeupdate":this._hasPoll()||
this._stopPoll();case "seeked":this._hasPositionChange()||this._el.detachEvent("PositionChange",this._onPositionChange);break;case "waiting":case "playing":this._hasBuffering()||this._el.detachEvent("Buffering",this._onBuffering);break;case "error":this._el.detachEvent("Error",b);break;case "progress":case "ended":case "play":case "pause":this._hasPlayStateChange()||this._el.detachEvent("PlayStateChange",this._onPlayStateChange);break;case "loadstart":case "loadeddata":case "canplay":this._hasOpenStateChange()||
this._el.detachEvent("OpenStateChange",this._onOpenStateChange);break;case "canplaythrough":case "durationchange":this._hasPoll()||this._stopPoll();break;default:break}}},_fire:function(a){var b;if(this._handler&&(b=this._handler[a])){a=0;for(var c=b.length;a<c;a++)b[a].call(this)}},_startPoll:function(){if(this._timer===undefined){this._canPlayThroughFired=this._canPlayThroughFired||this._el.network.downloadProgress===100;this._duration=this.getDuration();var a=this;this._timer=setInterval(function(){if(a._isPlaying&&
!a._isBuffering&&(a._handler.timeupdate||0).length&&(a._el.currentMedia||0).sourceURL)a._fire("timeupdate");var b=a.getDuration();if(a._duration!==b){a._duration=b;a._fire("durationchange")}if(!a._canPlayThroughFired)if(a._el.network.downloadProgress===100){a._canPlayThroughFired=true;a._fire("canplaythrough")}},1E3)}},_stopPoll:function(){clearInterval(this._timer);delete this._timer},_hasPositionChange:function(){return this._handler.timeupdate&&this._handler.timeupdate.length||this._handler.seeked&&
this._handler.seeked.length},_hasBuffering:function(){return this._handler.waiting&&this._handler.waiting.length||this._handler.playing&&this._handler.playing.length},_hasPlayStateChange:function(){return this._handler.progress&&this._handler.progress.length||this._handler.ended&&this._handler.ended.length||this._handler.play&&this._handler.play.length||this._handler.pause&&this._handler.pause.length},_hasOpenStateChange:function(){return this._handler.loadstart&&this._handler.loadstart.length||this._handler.loadeddata&&
this._handler.loadeddata.length||this._handler.canplay&&this._handler.canplay.length},_hasPoll:function(){return this._handler.timeupdate&&this._handler.timeupdate.length||this._handler.canplaythrough&&this._handler.canplaythrough.length||this._handler.durationchange&&this._handler.durationchange.length}});break;case i.NONE:d.Audio=d.Class({extend:e},{init:function(){d.warn("Audio is not supported","Audio")}});break;default:break}});
